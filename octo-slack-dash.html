<!DOCTYPE html>
<html>
    <head>
        <title>Octo-Slack-Dash</title>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="osd-scripts.js"></script>
        <script src="osd-printers.js"></script>
        <script src="osd-http-request-wrapper.js"></script>
        <script src="printer-module.js"></script>
        <script src="sockjs.min.js"></script>
        <script src="packed-client.js"></script>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
        <link href="osd-css.css" rel="stylesheet">
        <link href="osd-css-modals.css" rel="stylesheet">
        <link href="osd-css-overlays.css" rel="stylesheet">
        <link href="osd-css-printer-modules.css" rel="stylesheet">
    </head>
    <body>
        <div id="test_area"></div>
        <div class="nav_bar" id="nav_bar"></div>
        <div class="octo_slack_modal" id="octo_slack_modal"></div>
        <div class="snapshot_modal" id="snapshot_modal"></div>
        <div class = "shell">
            <div class="container" id="container"></div>
        </div><!--./shell-->

        <script>
            var blackMamba = new printer("Black Mamba", "Rostock Max v2", 1, true);
            var mobyDick = new printer("Moby Dick", "Rostock Max v2", 1, true);
            var printrbot = new printer("Printrbot", "PrintrBot Simple Metal", 1, false);
            var stu = new printer("Stu i3", "Wanhao Duplicator i3", 1, true);
            // var ultimaker = new printer("Ultimaker", "Ultimaker 2+", 1, true);

            OctoPrint.options.baseurl = "http://155.97.12.124";
            OctoPrint.options.apikey = "octopi4apikey";

            // OctoPrint.socket.connect();
            //
            // OctoPrint.socket.onMessage("test", function(message){
            //     document.getElementById('test_area').innerHTML = response;
            // });

            createNavBar();
            createOctoSlackModal();
            createSnapshotModal();
            createWindowEventListeners();

            $(document).ready(function(){
                $("button").click(function(){
                    //stu.requestBatchInfo();
                    OctoPrint.job.get()
                        .done(function(data, status){
                            stu.printerModule.updatePrinterStatus(data);
                            var printerState = data.state;
                            if(printerState == "Operational") {
                                stu.printerModule.DOM.className += " idle";
                            }
                            document.getElementById("test_area").innerHTML = data.state;
                        })
                        .fail(function(){
                            console.error("Test OctoPrint Javascript API request failed.");
                            stu.printerModule.DOM.className = "printer_module error"
                        });
                });
            });

        </script>
        <button>Send an HTTP GET request</button>
    </body>
</html>
